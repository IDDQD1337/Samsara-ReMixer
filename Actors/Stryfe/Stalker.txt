Actor StrifeStalker
{
	Tag "Stalker"
	Species "Enemies"	
	Health 80
	Painchance 40
	Speed 16
	Radius 30
	Height 25
	DamageFactor "CorvusCrossbow", 1.1
    DamageFactor "DragonClaw", 1.5
	DamageFactor "MarathonFusion", 2.0
    PainChance "MightyBoot", 255
	PainChance "MarathonStun", 255
	PainChance "ShrinkerDMG", 0
	MONSTER
	+DROPOFF
	+NOBLOOD
	+FLOORCLIP
	+NOTDMATCH
	+NOICEDEATH
	+NOINFIGHTING
	MaxDropOffHeight 32
	MinMissileChance 150
	SeeSound "stalker/sight"
	PainSound "stalker/pain"
	DeathSound "stalker/death"
	ActiveSound "stalker/active"
	HitObituary "$OB_STALKER"
	States
	{
		Spawn:
			STLK K 0
			STLK K 1 A_JumpIfInventory("AlreadySpawned",1,"Spawn2")
			STLK K 1 ACS_NamedExecuteAlways("ReMixerSpawnScript",0,1,0)
			STLK K 0 A_GiveInventory("AlreadySpawned",1)
		Spawn2:
			STLK K 5 A_Look
			Loop		
		See:
			STLK J 3 A_Chase
			STLK KK 3 A_Chase
			TNT1 A 0 A_PlaySound("stalker/walk",5)
			STLK L 3 A_Chase
			STLK L 3 A_Chase
			Loop
		Melee:
			TNT1 A 0 A_ChangeFlag("NOPAIN",0)
			STLK J 3 A_FaceTarget
			STLK K 3 A_CustomMeleeAttack(2*random(1,8),"stalker/attack")
			Goto See
		Pain:
			STLK L 1 A_Pain
			Goto See
		Death:
		XDeath:
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			STLK O 4
			STLK P 4 A_Scream
			STLK QRST 4
			STLK U 4 A_NoBlocking
			STLK VW 4
			STLK "XYZ[" 4 Bright
			Stop
		Crush:
			TNT1 A -1
			Stop
		Death.DukeDamage:
		Death.DukeExplosive:
		Death.DukePistol:
			TNT1 A 0 A_Jump(218,"Death")
			TNT1 A 0 A_GiveToTarget("DukeRobotKill",1)
			goto Death
		Death.MightyBoot:
			TNT1 A 0 A_PlaySoundEx("duke/kickhit","body",0,0)
			TNT1 A 0 A_Jump(64,"Death")
			TNT1 A 0 A_GiveToTarget("DukeBootTaunt",1)			
			Goto Death
		Pain.MightyBoot:
			TNT1 A 0 A_ChangeFlag("NOPAIN",1)
			TNT1 A 0 A_PlaySoundEx("duke/kickhit","body",0,0)
			STLK L 2 A_FaceTarget
			TNT1 A 0 A_Recoil(14)
			STLK L 16 A_Pain
			Goto See		
		Pain.MarathonStun:
			TNT1 A 0 A_Stop
			TNT1 A 0 A_GiveInventory("NothingSpeed")
			TNT1 A 0 A_PlaySoundEx("marathon/tech50/stun","body",0,0)
			STLK L 5 A_FaceTarget
			STLK L 30 A_Pain
			STLK L 70
			Goto See
		Death.ZorchPistol:
		Death.Zorch:
		Death.ZorchKamikaze:
		Death.PhasingZorch:
		Death.ZorchSpectral:
			"####" "#" 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			"####" "#" 0 A_Stop
			"####" "#" 0 A_NoGravity			
			"####" "#" 0 A_ChangeFlag("DONTGIB",1)
			"####" "#" 0 A_PlaySoundEx("chex/zorch","soundslot5",0,0)
			"####" "#" 3 A_SpawnItem("ZorchEffectSmall")
			"####" "#" 0 A_GiveInventory("EnemyZorched",1)
			"####" "#" 3 A_SetTranslucent(0.9,0)
			"####" "#" 0 A_Scream
			"####" "#" 3 A_SetTranslucent(0.8,0)
			"####" "#" 0 A_NoBlocking
			"####" "#" 3 A_SetTranslucent(0.7,0)
			"####" "#" 3 A_SetTranslucent(0.6,0)
			"####" "#" 3 A_SetTranslucent(0.5,0)
			"####" "#" 3 A_SetTranslucent(0.4,0)
			"####" "#" 3 A_SetTranslucent(0.3,0)
			"####" "#" 3 A_SetTranslucent(0.2,0)
			"####" "#" 3 A_SetTranslucent(0.1,0) 
			TNT1 A 1 A_SetTranslucent(1,0)
			"####" "#" -1
			stop	
		Death.DukeIce:
			"####" "#" 0 A_PlaySound("duke/enemyfreeze")
			"####" "#" 0 A_GiveInventory("FreezethrowerWeakness")
			"####" "#" 0 A_Jump(218,"Ice")
			"####" "#" 0 A_GiveToTarget("DukeKillTaunt",1)
		Ice:
		Death.HexenIce:
		Death.WTMeleeIce:
		Death.WTRangedIce:
		Death.Ice:
			"####" "#" 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			"####" "#" 0 A_GenericFreezeDeath
			"####" "#" 70 A_UnsetSolid
			"####" "#" 0 A_IceGuyDie
			"####" "#" 1 A_IceGuyDie
			TNT1 A 0
			stop
		Death.Vodoo:
		Death.VoodooPuff:
		Death.DynamiteCoop:
		Death.Dynamite:
		Death.LifeLeech:
		Death.CalebNapalm:
		Death.Shock:	  
		Death.Vodoo:
			TNT1 A 0 A_JumpIfHealthLower(-20,"XDeathForCaleb")
		Death.Tesla:
		Death.CalebFire:	
		Death.CalebBullet:	
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("CalebDMTaunt1", 1)
			Goto Death
		XDeathForCaleb:
			TNT1 A 0 A_UnsetSolid
			TNT1 A 0 A_Jump(96,"XDeath")
			TNT1 A 0 A_GiveToTarget("CalebDMTaunt1",1)
			Goto XDeath		
		Death.EradExplosive:
		Death.EradNova:
		Death.EradShock:
		Death.EradExplosive2:	
			TNT1 A 0 A_JumpIfHealthLower(-5,"XDeathForCatBitch")
		Death.EradDisc:
		Death.EradPiercingDart:
		Death.EradGreenFire:
		Death.EradCoopGreenFire:
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("EleenaDMTaunt1", 1)
			Goto Death
		XDeathForCatBitch:
			TNT1 A 0 A_UnsetSolid
			TNT1 A 0 A_Jump(96,"XDeath")
			TNT1 A 0 A_GiveToTarget("EleenaGibTaunt",1)
			Goto XDeath
		Death.PSRAPower:
		Death.PSRAPowerCoop:
		Death.PSExplosive:
		Death.PSExplosiveCoop:
			TNT1 A 0 A_JumpIfHealthLower(-30, "XDeathForJon")
		Death.PSBullet:
		Death.PSFire:	
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("JonDMTaunt1", 1)
			Goto Death
		XDeathForJon:
			TNT1 A 0 A_UnsetSolid
			TNT1 A 0 A_Jump(96,"XDeath")
			TNT1 A 0 A_GiveToTarget("JonDMTaunt1",1)
			Goto XDeath		
		Death.LeonardDamage2:
		Death.LeonardDamage3:
			TNT1 A 0 A_JumpIfHealthLower(-20, "XDeathForLeonard")
		Death.LeonardDamage0:
		Death.LeonardDamage1:	
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("LeonardDMTaunt1", 1)
			Goto Death
		XDeathForLeonard:
			TNT1 A 0 A_UnsetSolid
			TNT1 A 0 A_Jump(96,"XDeath")
			TNT1 A 0 A_GiveToTarget("LeonardGibTaunt",1)
			Goto XDeath		
		Death.SWFist:
		Death.SWKatana:
		Death.SWShuriken:
		Death.SWSticky:
	    Death.SWStickyCoop:	
		Death.SWGrenade:
		Death.SWNuke:
		Death.SWRocket:
		Death.SWRailgun:
		Death.SWRailgunCoop:
		Death.SWNukeCoop:
		Death.SWFlame:
		Death.SWFlame2:
		Death.SWFlame2Coop:
		Death.SWFlame3:	
			TNT1 A 0 A_JumpIfHealthLower(-3,"XDeathForWang")
		Death.SWBullet:	  
			TNT1 A 0 A_Jump(218, "Death")
			TNT1 A 0 A_GiveToTarget("LoWangDMTaunt1", 1)
			goto Death
		XDeathForWang:
			TNT1 A 0 A_UnsetSolid
			TNT1 A 0 A_Jump(218, "XDeath")
			TNT1 A 0 A_GiveToTarget("LoWangDMTaunt2",1)
			goto XDeath		
		 Death.RottDisintegrate:
			"####" "#" 0 A_ChangeFlag("SOLID", 0)
			"####" "#" 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			"####" "#" 0 A_Scream
			"####" "#" 0 A_NoBlocking
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 0 A_Stop
			"####" "#" 0 A_ChangeFlag("SHOOTABLE",FALSE)
			"####" "#" 0 A_ChangeFlag("NOGRAVITY",TRUE)
			"####" "#" 0 A_ChangeFlag("FLOORCLIP",TRUE)
			"####" "#" 0 A_SpawnItem("RGodModeDeathSmall")
			"####" "#" 3 A_SetTranslucent(0.9,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.8,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.7,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.6,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.5,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.4,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.3,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.2,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.1,0)
			stop
		Disintegrate:
			"####" "#" 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			"####" "#" 0 A_NoBlocking
			"####" "#" 0 A_ChangeFlag("DONTGIB",1)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 0 A_Scream
			"####" "#" 0 A_ChangeFlag("SOLID",FALSE)
			"####" "#" 0 A_ChangeFlag("SHOOTABLE",FALSE)
			"####" "#" 0 A_ChangeFlag("NOGRAVITY",TRUE)
			"####" "#" 0 A_ChangeFlag("FLOORCLIP",TRUE)
			"####" "#" 0 A_Stop
			"####" "#" 3 A_SpawnItem("DisintEffectSmallThin",0,10)
			"####" "#" 3 A_SetTranslucent(0.9,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.8,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.7,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.6,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 3 A_SetTranslucent(0.5,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.4,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.3,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.2,0)
			"####" "#" 0 ACS_NamedExecuteAlways("ExtraDeathFX",0,1)
			"####" "#" 2 A_SetTranslucent(0.1,0)
			"####" "#" 0
			stop
		Death.Nuke:
			"####" "#" 0 A_ChangeFlag("SOLID", 0)
			"####" "#" 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			"####" "#" 0 A_Scream
			"####" "#" 0 A_NoBlocking		
			"####" "#" 0 A_NoGravity			
			"####" "#" 0 A_SpawnItem("WTNukeDeathSmall")
			"####" "#################" 3 A_Fadeout(0.05)
			stop				
	}
}

Actor ShadowStalker : StrifeStalker
{
	+SHADOW
	RenderStyle OptFuzzy
	Alpha 0.5
	Obituary "%o thought %g saw a stalker."
	States
	{
		Death:
			TNT1 A 0 A_ClearShadow
			goto "Super::Death"
	}
}
	
Actor StrifeStalkerCeiling : StrifeStalker {
	+NOGRAVITY
	+SPAWNCEILING
	+NOVERTICALMELEERANGE
	+CEILINGHUGGER
	+MOVEWITHSECTOR
	States {
		Spawn:
			TNT1 A 0 A_Jump(256,"LookFloor")
			TNT1 A 0 A_CheckFlag(NOGRAVITY,"CeilingSet")
		LookFloor:
			STLK K 5 A_Look
			Loop
		CeilingSet:
			TNT1 A 0 A_GiveInventory("IsOnCeiling",1)
			6K4B B 5 ThrustThingZ(0,500,0,1)
			TNT1 A 0 A_ChangeFlag(CEILINGHUGGER,0)			
		LookCeiling:
			TNT1 A 0 A_JumpIf(CallACS("IsThisSky") == 1, "Drop")		
			6K4B B 5 A_Look
			Loop
		See:		
			TNT1 A 0 A_JumpIfInventory("IsOnCeiling",1,"SeeCeiling")
		SeeLoop:
			STLK J 3 A_Chase
			STLK KK 3 A_Chase
			STLK L 0 A_PlaySound("stalker/walk",5)
			STLK L 3 A_Chase
			STLK L 3 A_Chase
			Loop		
		SeeCeiling:
			TNT1 A 0 A_JumpIf(CallACS("IsThisSky") == 1, "Drop")		
			TNT1 A 0 A_CheckCeiling(1)
			Goto Drop
			6K4B A 3 A_Chase			
			TNT1 A 0 A_JumpIf(CallACS("IsThisSky") == 1, "Drop")			
			TNT1 A 0 A_CheckCeiling(1)
			Goto Drop
			6K4B B 3 A_Chase
			TNT1 A 0 A_Jump(2,"Drop")
			TNT1 A 0 A_JumpIf(CallACS("IsThisSky") == 1, "Drop")			
			TNT1 A 0 A_CheckCeiling(1)
			Goto Drop
			6K4B B 3 A_Chase			
			TNT1 A 0 A_JumpIf(CallACS("IsThisSky") == 1, "Drop")			
			TNT1 A 0 A_CheckCeiling(1)
			Goto Drop
			TNT1 A 0 A_PlaySound("stalker/walk",5)
			6K4B C 3 A_Chase
			TNT1 A 0 A_JumpIf(CallACS("IsThisSky") == 1, "Drop")			
			TNT1 A 0 A_CheckCeiling(1)
			Goto Drop
			6K4B C 3 A_Chase
			Loop
		Drop:
			TNT1 A 0 A_ChangeFlag(NOVERTICALMELEERANGE,0)
			TNT1 A 0 A_ChangeFlag(NOGRAVITY,0)									
			TNT1 A 0 A_ChangeFlag(MOVEWITHSECTOR,0)
			TNT1 A 0 A_TakeInventory("IsOnCeiling",1)
			6K4B DEFGHI 3
		Landing:
			6K4B I 1 A_CheckFloor("See")
			Loop
		Melee:
			TNT1 A 0 A_JumpIfInventory("IsOnCeiling",1,"Drop")
			STLK J 3 A_FaceTarget
			STLK K 3 A_CustomMeleeAttack(2*random(1,8),"stalker/attack")
			Goto See
		Pain:
			TNT1 A 0 A_JumpIfInventory("IsOnCeiling",1,"CeilingPain")
			STLK L 1 A_Pain
			Goto See
		CeilingPain:
			6K4B C 1 A_Pain
			Goto See
		Death:
		XDeath:
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_KillCount", 0, 0)
			TNT1 A 0 A_JumpIfInventory("IsOnCeiling",1,"CeilingDeath")
			STLK O 4
			STLK P 4 A_Scream
			STLK QRST 4
			STLK U 4 A_NoBlocking
			STLK VW 4
			STLK "XYZ[" 4 Bright
			Stop
		CeilingDeath:
			6K4B O 4
			6K4B P 4 A_Scream
			6K4B QRST 4
			6K4B U 4 A_NoBlocking
			6K4B VW 4
			6K4B "XYZ[" 4 Bright
			Stop			
		Pain.MightyBoot:
			TNT1 A 0 A_ChangeFlag("NOPAIN",1)
			TNT1 A 0 A_JumpIfInventory("IsOnCeiling",1,"Pain.MightyBootCeiling")
			TNT1 A 0 A_PlaySoundEx("duke/kickhit","body",0,0)
			STLK L 2 A_FaceTarget
			TNT1 A 0 A_Recoil(14)
			STLK L 16 A_Pain
			TNT1 A 0 A_ChangeFlag("NOPAIN",0)			
			Goto See		
		Pain.MarathonStun:
			TNT1 A 0 A_JumpIfInventory("IsOnCeiling",1,"Pain.MarathonStunCeiling")
			TNT1 A 0 A_Stop
			TNT1 A 0 A_GiveInventory("NothingSpeed")
			TNT1 A 0 A_PlaySoundEx("marathon/tech50/stun","body",0,0)
			STLK L 5 A_FaceTarget
			STLK L 30 A_Pain
			STLK L 70
			Goto See
		Pain.MightyBootCeiling:
			TNT1 A 0 A_PlaySoundEx("duke/kickhit","body",0,0)
			6K4B C 2 A_FaceTarget
			TNT1 A 0 A_Recoil(14)
			6K4B C 16 A_Pain
			TNT1 A 0 A_ChangeFlag("NOPAIN",0)
			Goto See
		Pain.MarathonStunCeiling:	
			TNT1 A 0 A_Stop
			TNT1 A 0 A_GiveInventory("NothingSpeed")
			TNT1 A 0 A_PlaySoundEx("marathon/tech50/stun","body",0,0)
			6K4B C 5 A_FaceTarget
			6K4B C 30 A_Pain
			6K4B C 70
			Goto See		
	}
}

ACTOR IsOnCeiling : Inventory { Inventory.MaxAmount 1 }

Actor ShadowStalkerCeiling : StrifeStalkerCeiling
{
	+SHADOW
	RenderStyle OptFuzzy
	Alpha 0.5
	Obituary "%o thought %g saw a stalker."
	States
	{
		Death:
			TNT1 A 0 A_ClearShadow
			goto "Super::Death"
	}
}